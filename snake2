#include <iostream>
#include <ctime>
#include <windows.h>
#define LX 10
#define LY 10
using namespace std;

HANDLE hout =GetStdHandle(STD_OUTPUT_HANDLE);
void gotoxy(int x,int y);void border(int lx,int ly);
void color(int c);
int lx=LX,ly=LY,hx,hy,ax,ay,tx,ty,tx1,ty1,i,j,d,sc,d1,t,ti=300,hs=0,cc=172,cs,cf=249;
int s[50][50];
bool g=false;
int main()
{
    //cout<<"LaturaX:";cin>>lx;
    //cout<<"LaturaY:";cin>>ly;
    //cout<<"Speed:";cin>>ti;
    lx+=2;ly+=2;
    INC:
    srand (time(NULL));
    d=1;sc=0;d1=1;t=ti;g=false;
    system("CLS");
    gotoxy(lx+5,3);cout<<"High scor ";
    gotoxy(lx+5,4);cout<<"Scor ";
    //gotoxy(lx+5,5);cout<<"Speed ";
    for(i=0;i<ly;i++)for(j=0;j<lx;j++)s[j][i]=0;
    //for(i=0;i<lx;i++){s[i][0]=7;s[i][ly-1]=7;}
    //for(i=0;i<ly;i++){s[0][i]=7;s[lx-1][i]=7;}
    border(lx,ly);
    hx=lx/2;hy=ly/2;tx=hx;ty=hy;
    ax=rand()%(lx)+1;ay=rand()%(ly)+1;
    color(12);
    gotoxy(ax,ay);cout<<'X';
    color(cf);s[ax][ay]=5;
    while(g==false)
    {
        color(170);
        gotoxy(hx,hy);cout<<'0';
        color(cf);
        if(GetAsyncKeyState(VK_SPACE))
        {
            gotoxy(ax,ay);cout<<' ';
            s[ax][ay]=0;
            RET1:
            ax=rand()%(lx-3)+1;
            ay=rand()%(ly-3)+1;
            if(s[ax][ay]!=0||ax>lx-2||ay>ly-2)
                goto RET1;
            color(12);
            gotoxy(ax,ay);cout<<'X';
            s[ax][ay]=5;
            color(cf);
        }
        if(GetAsyncKeyState(VK_UP))     d1=1;
        if(GetAsyncKeyState(VK_DOWN))   d1=3;
        if(GetAsyncKeyState(VK_LEFT))   d1=4;
        if(GetAsyncKeyState(VK_RIGHT))  d1=2;
        if((d1!=d)&&((d1%2==0&&d%2!=0)||(d1%2!=0&&d%2==0)))
            d=d1;
        s[hx][hy]=d;
        switch(d)
        {
        case 1:hy--;break;
        case 2:hx++;break;
        case 3:hy++;break;
        case 4:hx--;break;
        }
        if(hx==lx-1)hx=1;
        if(hy==ly-1)hy=1;
        if(hx==0)hx=lx-2;
        if(hy==0)hy=ly-2;
        if(s[hx][hy]!=0)
        {
            if(s[hx][hy]==5)
            {
                sc++;
                t-=2;
                RET:
                ax=rand()%(lx-3)+1;
                ay=rand()%(ly-3)+1;
                if(s[ax][ay]!=0||ax>lx-2||ay>ly-2)
                    goto RET;
                color(12);
                gotoxy(ax,ay);cout<<'X';
                s[ax][ay]=5;
                color(cf);
            }else
            if(hx==tx&&hy==ty)
            {
                tx1=tx;ty1=ty;
                gotoxy(tx,ty);cout<<' ';
                if(s[tx][ty]==1)ty--;else
                if(s[tx][ty]==2)tx++;else
                if(s[tx][ty]==3)ty++;else
                if(s[tx][ty]==4)tx--;
                if(tx==lx-1)tx=1;
                if(ty==ly+1)ty=1;
                if(tx==0)tx=lx-2;
                if(ty==0)ty=ly-2;
                s[tx1][ty1]=0;
            }else
                g=true;
        }
        else
        {
            tx1=tx;ty1=ty;
            gotoxy(tx,ty);cout<<' ';
            if(s[tx][ty]==1)ty--;else
            if(s[tx][ty]==2)tx++;else
            if(s[tx][ty]==3)ty++;else
            if(s[tx][ty]==4)tx--;
            if(tx==lx-1)tx=1;
            if(ty==ly-1)ty=1;
            if(tx==0)tx=lx-2;
            if(ty==0)ty=ly-2;
            s[tx1][ty1]=0;
        }
        color(cc);
        gotoxy(hx,hy);cout<<'0';
        color(15);
        gotoxy(lx+15,3);cout<<hs;
        gotoxy(lx+10,4);cout<<sc;
        gotoxy(lx+12,5);cout<<"   ";
        //gotoxy(lx+12,5);cout<<t;
        Sleep(t);
    }
    if(sc>hs)
        hs=sc;
    goto INC;
    return 0;
}
void color(int c)
{
    SetConsoleTextAttribute(hout,c);
}
void gotoxy(int x,int y)
{
    COORD coord;
    coord.X=x;
    coord.Y=y;
    SetConsoleCursorPosition(hout,coord);
}
void border(int lx,int ly)
{
    gotoxy(1,1);
    color(cf);
    for(i=2;i<ly;i++)
    {
        for(j=2;j<lx;j++)
            cout<<' ';
        color(15);
        cout<<'\n'<<' ';
        color(cf);
    }

}
/*void border1(int lx,int ly)
{
    gotoxy(0,0);
    for(i=0;i<lx;i++)
        cout<<'-';
    cout<<'\n';
    for(i=0;i<ly-2;i++)
    {
        cout<<'|';
        for(j=0;j<lx-2;j++)
            cout<<' ';
        cout<<"|\n";
    }
    for(i=0;i<lx;i++)
        cout<<'-';
}*/
